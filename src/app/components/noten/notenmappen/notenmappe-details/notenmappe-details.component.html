<mkj-content-loader [loading]="loading">
    <div *ngIf="editMode" class="card">
        <div class="col-12 flex justify-content-end">
            <button
                pButton
                pRipple
                label="Speichern"
                [icon]="isSaving ? 'pi pi-spin pi-spinner' : 'pi pi-check'"
                class="p-button-plain"
                [disabled]="
                    isSaving ||
                    formGroup?.invalid ||
                    loading ||
                    formGroup?.pristine
                "
                (click)="saveMappe()"
            ></button>
        </div>
        <mkj-notenmappe-form
            *ngIf="formGroup"
            [formGroup]="formGroup"
        ></mkj-notenmappe-form>
    </div>

    <div *ngIf="formGroup?.controls.id.value">
        <p-table
            [value]="notenMappe.noten"
            [loading]="tableLocked"
            dataKey="id"
            responsiveLayout="scroll"
            styleClass="p-datatable p-datatable-striped"
        >
            <ng-template
                *visibleFor="[Permission.NOTENMAPPE_ASSIGN]"
                pTemplate="caption"
            >
                <div *ngIf="editMode" class="flex justify-content-center">
                    <app-mkj-notensuche
                        [verzeichnisMode]="
                            formGroup.controls.hatVerzeichnis.value
                        "
                        placeholder="Noten hinzufÃ¼gen"
                        (notenSelect)="addNotenToMappe($event)"
                        [class.p-disabled]="!formGroup.pristine"
                    ></app-mkj-notensuche>
                </div>
            </ng-template>
            <ng-template pTemplate="header"
                ><tr>
                    <th *ngIf="notenMappe.hatVerzeichnis">Verzeichnis</th>
                    <th>Titel</th>
                    <th>Komponist</th>
                    <th></th></tr
            ></ng-template>
            <ng-template pTemplate="body" let-noten>
                <tr>
                    <td *ngIf="notenMappe.hatVerzeichnis">
                        {{ noten.pivot.verzeichnisNr }}
                    </td>
                    <td>{{ noten.titel }}</td>
                    <td>{{ noten.komponist }}</td>
                    <td>
                        <button
                            *ngIf="canNavigateToNoten"
                            pButton
                            icon="pi pi-link"
                            class="p-button-text ml-2"
                            (click)="navigateToNoten(noten)"
                        ></button>
                        <button
                            *ngIf="canDetachNoten && editMode"
                            pButton
                            icon="pi pi-trash"
                            pTooltip="Aus Mappe entfernen"
                            class="p-button-text p-button-danger"
                            (click)="detachNotenFromMappe(noten)"
                        ></button>
                    </td>
                </tr>
            </ng-template>
        </p-table>
    </div>
</mkj-content-loader>
