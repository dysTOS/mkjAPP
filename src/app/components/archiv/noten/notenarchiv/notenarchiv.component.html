<p-table
    #notenTable
    [value]="notenArray"
    [loading]="loading"
    [globalFilterFields]="['titel', 'komponist', 'gattung', 'inventarId']"
    styleClass="p-datatable-striped p-datatable-noten rowexpand-table"
    dataKey="id"
    responsiveLayout="scroll"
    stateStorage="session"
    stateKey="notenarchivtable"
    rowExpandMode="single"
    [(selection)]="selectedRow"
    [rowHover]="true"
    dataKey="id"
    selectionMode="single"
    (onFilter)="setFilteredRows($event)"
>
    <ng-template pTemplate="caption">
        <div
            class="flex flex-column md:flex-row md:justify-content-between align-items-center"
        >
            <div class="m-2">
                Anzahl:
                {{ selectedNoten ? selectedNoten?.length + "/" : ""
                }}{{ notenArray?.length }}
            </div>

            <span class="p-input-icon-left">
                <i class="pi pi-search"></i>
                <input
                    pInputText
                    type="text"
                    [value]="notenTable.filters?.global?.value"
                    (input)="
                        notenTable.filterGlobal($event.target.value, 'contains')
                    "
                    placeholder="Suchen..."
                />
            </span>
        </div>
    </ng-template>
    <ng-template pTemplate="header"
        ><tr>
            <th pSortableColumn="inventarId">
                Inv. Nr <p-sortIcon field="inventarId"></p-sortIcon>
            </th>
            <th pSortableColumn="titel">
                Titel <p-sortIcon field="titel"></p-sortIcon>
            </th>
            <th class="not-on-small">Komponist</th>
            <th class="not-on-small">Arrangeur</th>
            <th class="not-on-small">Verlag</th>
            <th pSortableColumn="gattung" class="not-on-small">
                <span>Gattung</span>
                <p-columnFilter
                    field="gattung"
                    matchMode="equals"
                    display="menu"
                    [showOperator]="false"
                    [showClearButton]="true"
                    [showApplyButton]="true"
                    [showMatchModes]="false"
                    [showAddButton]="false"
                    [hideOnClear]="true"
                >
                    <ng-template
                        pTemplate="filter"
                        let-value
                        let-filter="filterCallback"
                    >
                        <p-dropdown
                            [ngModel]="value"
                            [options]="GattungOptionen"
                            (onChange)="filter($event.value)"
                            placeholder="Filter"
                        >
                            <ng-template let-option pTemplate="item">
                                <span>{{ option.label }}</span>
                            </ng-template>
                        </p-dropdown>
                    </ng-template>
                </p-columnFilter>
            </th>
        </tr>
    </ng-template>
    <ng-template
        pTemplate="body"
        let-noten
        let-expanded="expanded"
        let-rowIndex="rowIndex"
    >
        <tr
            [pSelectableRow]="noten"
            [pSelectableRowIndex]="rowIndex"
            [pRowToggler]="noten"
        >
            <td>{{ noten.inventarId }}</td>
            <td>
                {{ noten.titel }}
            </td>
            <td class="not-on-small">
                {{ noten.komponist }}
            </td>
            <td class="not-on-small">{{ noten.arrangeur }}</td>
            <td class="not-on-small">{{ noten.verlag }}</td>
            <td class="not-on-small">{{ noten.gattung }}</td>
        </tr>
    </ng-template>
    <ng-template pTemplate="rowexpansion" let-noten>
        <tr>
            <td colspan="12">
                <div class="col-12">
                    <noten-card [noten]="noten"></noten-card>
                </div>
                <div class="col-12 flex justify-content-center">
                    <button
                        *visibleFor="[PermissionMap.NOTEN_SAVE]"
                        pButton
                        pRipple
                        label="Bearbeiten"
                        icon="pi pi-pencil"
                        class="p-button-outlined p-button-sm p-button-info mr-1"
                        (click)="navigateToEditView(noten)"
                    ></button>
                </div>
            </td>
        </tr>
    </ng-template>
</p-table>
